@model EurovisionTotalizer.API.ViewModels.DataEntryViewModel
@{
    ViewBag.Title = "Duomenų įvedimas";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="~/css/dataentry.css" />

<div class="dataentry-shell">
    <aside class="dataentry-menu">
        <ul>
            <li><a href="#read" class="menu-link">Read Data</a></li>
            <li><a href="#update" class="menu-link">Update</a></li>
            <li><a href="#delete" class="menu-link">Delete</a></li>
            <li><a href="#create" class="menu-link">Create Data</a></li>
        </ul>
    </aside>

    <section class="dataentry-content">
        <!-- Read Data -->
        <div id="read">
            <h2>Read Data</h2>
            <p>Visos šalys ir dalyviai:</p>
            <ul>
                @foreach (var p in Model.Participants)
                {
                    <li>Dalyvis: @p.Name </li>
                }
                @foreach (var c in Model.Countries)
                {
                    <li>Šalis: @c.Name - @c.SemiFinal</li>
                }
            </ul>
        </div>

        <!-- Update -->
        <div id="update">
            <h2>Update</h2>
            <p>Pasirink šalį:</p>
            <select id="entity-select">
                <option value="">-- Pasirink --</option>
                @foreach (var c in Model.Countries)
                {
                    <option data-type="country" value="country-@c.Name">@c.Name</option>
                }
            </select>

            <form id="update-form" asp-controller="DataEntry" asp-action="Update" method="post" style="display:none;">
                <input type="hidden" id="entity-type" name="Type" />

                <div id="country-fields" style="display:none; margin-top: 15px;">
                    <label>
                        Name:
                        <input type="text" name="Name" id="country-name" />
                    </label>
                    <br />

                    <label>
                        Is In Final:
                        <input type="checkbox" name="IsInFinal" id="country-infinal" />
                    </label>
                    <br />

                    <label>
                        SemiFinal:
                        <select name="SemiFinal" id="country-semifinal">
                            <option value="0">None</option>
                            <option value="1">First</option>
                            <option value="2">Second</option>
                        </select>
                    </label>
                    <br />

                    <label>
                        Place in Final:
                        <input type="number" name="PlaceInFinal" id="country-place" />
                    </label>
                </div>

                <button type="submit">Update</button>
            </form>
        </div>


        <!-- Delete -->
        <div id="delete">
            <h2>Delete</h2>
            <form asp-controller="DataEntry" asp-action="Delete" method="post">
                <p>Pasirink šalį ar dalyvį:</p>
                <select name="name">
                    @foreach (var p in Model.Participants)
                    {
                        <option value="participant:@p.Name">@p.Name (Dalyvis)</option>
                    }
                    @foreach (var c in Model.Countries)
                    {
                        <option value="country:@c.Name">@c.Name (Šalis)</option>
                    }
                </select>
                <button type="submit">Submit</button>
            </form>
        </div>

        <!-- Create -->
        <div id="create">
            <h2>Create Data</h2>
            <form asp-controller="DataEntry" asp-action="Create" method="post">
                <p>Pasirink ką kurti:</p>
                <select id="create-type" name="Type">
                    <option value="participant">Dalyvis</option>
                    <option value="country">Šalis</option>
                </select>
                <input type="text" id="create-name" name="Name" placeholder="Įvesk vardą" required />
                <select id="create-additional" name="Additional">
                    <option value="0">none</option>
                    <option value="1">first</option>
                    <option value="2">second</option>
                </select>
                <button type="submit">Create</button>
            </form>
        </div>
    </section>
</div>

<script>
    const createType = document.getElementById('create-type');
    const additionalField = document.getElementById('create-additional');

    function toggleAdditionalField() {
        if (createType.value === 'country') {
            additionalField.style.display = 'block';
        } else {
            additionalField.style.display = 'none';
            additionalField.value = '';
        }
    }

    toggleAdditionalField();
    createType.addEventListener('change', toggleAdditionalField);
</script>

<script>
    document.getElementById("entity-select").addEventListener("change", function () {
        const selectedName = this.value;
        const type = this.options[this.selectedIndex].dataset.type;

        if (!selectedName) {
            document.getElementById("update-form").style.display = "none";
            return;
        }

        document.getElementById("entity-type").value = type;
        document.getElementById("entity-name").value = selectedName;

        if (type === "country") {
            document.getElementById("country-fields").style.display = "block";
            document.getElementById("update-form").style.display = "block";

            fetch(`/DataEntry/GetCountryByName/${selectedName}`)
                .then(r => r.json())
                .then(data => {
                    document.getElementById("country-name").value = data.name;
                    document.getElementById("country-infinal").checked = data.isInFinal;
                    document.getElementById("country-semifinal").value = data.semiFinal;
                    document.getElementById("country-place").value = data.placeInFinal ?? "";
                });
        } else {
            document.getElementById("country-fields").style.display = "none";
        }
    });
</script>


